
require 'dxruby'

CHIP_SIZE = 32
G = 0.3

require './map'
require './player'
require './enemy'

Window.width = 640
Window.height = 480

$debug_font = Font.new(14)

$camera_x = 0
$camera_y = 0

player = Player.create
enemy = Enemy.create
map = Map.new([
  [1,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,1],
  [1,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,1],
  [1,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,1],
  [1,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,1],
  [1,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 1,1,0,0,0, 0,0,0,0,1],

  [1,0,0,0,0, 1,1,0,1,1, 0,0,0,0,0, 0,0,0,1,1, 0,0,0,0,1],
  [1,0,0,0,0, 0,0,0,0,0, 0,0,1,1,0, 0,0,0,0,0, 0,0,1,0,1],
  [1,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,1,0,1],
  [1,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,1],
  [1,0,0,0,0, 0,0,1,1,0, 0,0,0,0,0, 0,0,1,1,0, 1,0,0,0,1],

  [1,0,0,0,0, 1,1,1,1,1, 0,0,0,0,1, 1,1,1,1,1, 1,0,0,0,1],
  [1,0,0,0,0, 1,1,1,1,1, 0,0,0,1,1, 1,1,1,1,1, 1,0,0,0,1],
  [1,0,0,0,0, 0,0,0,0,0, 0,0,0,1,1, 0,0,0,0,0, 1,0,0,0,1],
  [1,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,0, 0,0,0,0,1],
  [1,1,1,1,1, 1,1,1,1,1, 1,1,1,1,1, 1,1,1,1,1, 1,1,1,1,1],
])

Window.loop do
  # Update
  # =====================================
  exit if Input.keyDown? K_ESCAPE
  player.update(map)
  enemy.update(map)

  # Draw
  map.draw
  player.draw
  enemy.draw

  Window.drawFontEx(0, 0,
    "#{$camera_x.to_i}, #{$camera_y.to_i} : #{player.x.to_i}, #{player.y.to_i}", $debug_font,
    color: [255,255,255], edge: true, edge_color: [0,0,0], edge_width: 1, z: 100)
end
